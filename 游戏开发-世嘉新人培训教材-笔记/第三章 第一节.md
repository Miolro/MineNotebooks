# 第三章
## 3.1 读取图片文件

## 3.1.3 分析DDS的结构

- 0-3 字节(4Byte)表示dwMagic
- 4-127 字节 (124Byte) DDSURFCEDESC2结构体
- 128-结尾  十六进制表示的像素色彩

`DDSURFCEDESC2结构体`

```C++
    struct DDSYRFACEDESC2
    {
	char dwSize[4];            // 结构体大小
	char dwFlages[4];           // 标识位
	char dwHeight[4];           // 图片高度
	char dwWidth[4];            // 图片宽度
	char dwPitchOrLinearSize[4];    // 一行字节数
	char dwDepth[4];                // 3d纹理深度
	char dwMipMapCount[4 * 8];// 有4个双字节且有8个位置字节单元未使用
	char ddpfPixelFormat[4];// 图片格式结构体

    };


```

`读取格式信息`

直接对字节去读一组一组的读

```C++
    int main()
    {
        ifstream ddsImage("face.dds");
        char* imageHeader = new char[128];
        ddsImage.read(imageHeader, 128);

        DDSYRFACEDESC2* ddsStruct = reinterpret_cast<DDSYRFACEDESC2*>(&imageHeader[4]); // dds图片从第四位开始之后是结构体内容
        unsigned dwHeight = *(reinterpret_cast<unsigned*> (ddsStruct->dwHeight));  // 直接取会变成结构体内的地址
        unsigned dwWidth = *(reinterpret_cast<unsigned*>(ddsStruct->dwWidth));// 直接取会变成结构体内的地址
        char* imgType = ddsStruct->ddpfPixelFormat;
        cout << &dwHeight << endl;
        cout << &dwWidth << endl;
    }
    
```

```C++
    // 如果结构体中设置的是unsigned的话那么就写为 此时不需要类型转换  因为在读字节时候默认读4字节然后转为无符号int存储
        unsigned dwHeight = ddsStruct->dwHeight;
```


笔者并不推崇这样的读取方式接下去会解释原因,`对其(ailgnment)`,`端(endian)`

`类型转换`

- static_cast 用于大部分类型转换 比如 int->float 但是无法将常量转为非常量
- reinterpret_cast 这是用于指针类型转换的  上面char[4]转为unsigned类型就是使用的这个`笔者并不推荐`但是迫不得已可以使用,比如上面读文件的情况
- canst_cast 这个仅仅只是用于去除常量表示符`疑似笔者吐槽:如果你用到了这个你的程序肯定是设计有问题了`
- dynamic_cast 第十章说明


`对齐`

对应的类型都有自己的长度，想想如果一个值存储在内存中他长度只有7，他不能被4整除，但是你想去读他会发生什么呢，我猜的话程序为了满足整除会去补齐下一个字节，也就是把下一个数据的第一个字节并在一起读可能结果就不是想要的结果了

所以处理这样的情况一般一个字一个字读读出来然后分别处理完字之后做拼接

`端`

合成方式不能乱来需要看端，读出来处理完之后有两个数1和5，那在拼接时应该是1在前还是5在前呢
- 大端 从高位开始写向低位 (平时写作业时候写计算题或者声明一个变量给出一个常量值)
- 小端 从低位开始写向高位 (正常情况下计算机中向内存写入数据)

`读取格式信息`

- 步骤传入一个字符
- 获取字符第一位转unsigned
- 保存这一位
- 然后获取下一个字符转unsigned 并且左移8位移动到下一个字节并加到前面的的unsigned中
- 然后如此反复

## 3.1.4 尝试取出数据


